/* ***** BEGIN LICENSE BLOCK *****
 * Distributed under the BSD license:
 *
 * Copyright (c) 2010, Ajax.org B.V.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of Ajax.org B.V. nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * ***** END LICENSE BLOCK ***** */
define("ace/ext/emmet",["require","exports","module","ace/keyboard/hash_handler","ace/editor","ace/config"],function(t,e){function n(){}function i(t){if(c.setupContext(t),"php"==c.getSyntax())return!1;var e=a.require("actions");try{var n=e.run(this.name,c)}catch(i){t._signal("changeStatus","string"==typeof i?i:i.message)}return n}var a,s=t("ace/keyboard/hash_handler").HashHandler,o=t("ace/editor").Editor;o.prototype.indexToPosition=function(t){return this.session.doc.indexToPosition(t)},o.prototype.positionToIndex=function(t){return this.session.doc.positionToIndex(t)},n.prototype={setupContext:function(t){this.ace=t,this.indentation=t.session.getTabString(),a.require("resources").setVariable("indentation",this.indentation),this.$syntax=null,this.$syntax=this.getSyntax()},getSelectionRange:function(){var t=this.ace.getSelectionRange();return{start:this.ace.positionToIndex(t.start),end:this.ace.positionToIndex(t.end)}},createSelection:function(t,e){this.ace.selection.setRange({start:this.ace.indexToPosition(t),end:this.ace.indexToPosition(e)})},getCurrentLineRange:function(){var t=this.ace.getCursorPosition().row,e=this.ace.session.getLine(t).length,n=this.ace.positionToIndex({row:t,column:0});return{start:n,end:n+e}},getCaretPos:function(){var t=this.ace.getCursorPosition();return this.ace.positionToIndex(t)},setCaretPos:function(t){var e=this.ace.indexToPosition(t);this.ace.clearSelection(),this.ace.selection.moveCursorToPosition(e)},getCurrentLine:function(){var t=this.ace.getCursorPosition().row;return this.ace.session.getLine(t)},replaceContent:function(t,e,n,i){null==n&&(n=null==e?content.length:e),null==e&&(e=0);var s=a.require("utils");i||(t=s.padString(t,s.getLinePaddingFromPosition(this.getContent(),e)));var o=a.require("tabStops").extract(t,{escape:function(t){return t}});t=o.text;var r=o.tabstops[0];r?(r.start+=e,r.end+=e):r={start:t.length+e,end:t.length+e};var c=this.ace.getSelectionRange();c.start=this.ace.indexToPosition(e),c.end=this.ace.indexToPosition(n),this.ace.session.replace(c,t),c.start=this.ace.indexToPosition(r.start),c.end=this.ace.indexToPosition(r.end),this.ace.selection.setRange(c)},getContent:function(){return this.ace.getValue()},getSyntax:function(){if(this.$syntax)return this.$syntax;var t=this.ace.session.$modeId.split("/").pop();if("html"==t||"php"==t){var e=this.ace.getCursorPosition(),n=this.ace.session.getState(e.row);"string"!=typeof n&&(n=n[0]),n&&(n=n.split("-"),n.length>1?t=n[0]:"php"==t&&(t="html"))}return t},getProfileName:function(){switch(this.getSyntax()){case"css":return css;case"xml":case"xsl":return"xml";case"html":var t=a.require("resources").getVariable("profile");return t||(t=-1!=this.ace.session.getLines(0,2).join("").search(/<!DOCTYPE[^>]+XHTML/i)?"xhtml":"html"),t}return"xhtml"},prompt:function(t){return prompt(t)},getSelection:function(){return this.ace.session.getTextRange()},getFilePath:function(){return""}};var r={expand_abbreviation:{mac:"ctrl+alt+e",win:"alt+e"},match_pair_outward:{mac:"ctrl+d",win:"ctrl+,"},match_pair_inward:{mac:"ctrl+j",win:"ctrl+shift+0"},matching_pair:{mac:"ctrl+alt+j",win:"alt+j"},next_edit_point:"alt+right",prev_edit_point:"alt+left",toggle_comment:{mac:"command+shift+/",win:"ctrl+shift+/"},split_join_tag:{mac:"shift+command+'",win:"shift+ctrl+`"},remove_tag:{mac:"command+'",win:"shift+ctrl+;"},evaluate_math_expression:{mac:"shift+command+y",win:"shift+ctrl+y"},increment_number_by_1:"ctrl+up",decrement_number_by_1:"ctrl+down",increment_number_by_01:"alt+up",decrement_number_by_01:"alt+down",increment_number_by_10:{mac:"alt+command+up",win:"shift+alt+up"},decrement_number_by_10:{mac:"alt+command+down",win:"shift+alt+down"},select_next_item:{mac:"shift+command+.",win:"shift+ctrl+."},select_previous_item:{mac:"shift+command+,",win:"shift+ctrl+,"},reflect_css_value:{mac:"shift+command+r",win:"shift+ctrl+r"},encode_decode_data_url:{mac:"shift+ctrl+d",win:"ctrl+'"},expand_abbreviation_with_tab:"Tab"},c=new n;e.commands=new s;for(var h in r)e.commands.addCommand({name:h,bindKey:r[h],exec:i});var m=function(t,n){var i=n;if(i){var a=i.session.$modeId,s=a&&/css|less|sass|html|php/.test(a);t.enableEmmet===!1&&(s=!1),s?i.keyBinding.addKeyboardHandler(e.commands):i.keyBinding.removeKeyboardHandler(e.commands)}};e.AceEmmetEditor=n,t("ace/config").defineOptions(o.prototype,"editor",{enableEmmet:{set:function(t){this[t?"on":"removeListener"]("changeMode",m),m({enableEmmet:!!t},this)},value:!0}}),e.setCore=function(t){a=t}});